{"Data":{"Forms":[{"Constructor":"CustomControlDesignPH","Config":{"Controls":[],"MemberCode":"This.OnDblClick.Attach(\u000afunction()\u000a{\u000a    if (This.GetSelectedNode().GetTag() != null)\u000a    {\u000a        var form = IMCore.Session.GetGlobal(\u0022ChatService\u0022).Open(This.GetSelectedNode().GetTag().Name\u002c false);\u000a    }\u000a});","CustomConfig":"config.Css = \u0022FriendPanel\u0022;\u000aconfig.DataSource = new FriendPanelDS(config.DSConfig);","BaseName":"Controls.TreeView","GlobalCode":"Module.FriendPanel = FriendPanel;\u000a\u000afunction FriendPanelDS(config)\u000a{\u000a    var obj = this;\u000a    if (config == undefined) config = {};\u000a    if (config.ShowState == undefined) config.ShowState = false;\u000a\u000a    obj.GetSubNodes = function(callback\u002c node)\u000a    {\u000a        if (node == null)\u000a        {\u000a            var nodes = [{\u000a                Name: \u0022Users\u0022\u002c\u000a                Text: \u0022联系人\u0022\u002c\u000a                Tag: null\u002c\u000a                ImageCss: \u0022Image16_Folder\u0022\u000a            }\u002c\u000a            {\u000a                Name: \u0022Groups\u0022\u002c\u000a                Text: \u0022群组\u0022\u002c\u000a                Tag: null\u002c\u000a                ImageCss: \u0022Image16_Folder\u0022\u000a            }];\u000a            callback(nodes);\u000a        }\u000a        else\u000a        {\u000a            var name = node.GetName();\u000a            if (name != \u0022Users\u0022 \u0026\u0026 name != \u0022Groups\u0022) return null;\u000a\u000a            var type = (name == \u0022Users\u0022 ? 0 : 1);\u000a\u000a            Common.GetFriends(function(friends)\u000a            {\u000a                var nodes = [];\u000a                for (var k in friends)\u000a                {\u000a                    var friend = friends[k];\u000a                    if (friend.Type == type)\u000a                    {\u000a                        if (type == 0)\u000a                        {\u000a                            nodes.push({\u000a                                Name: friend.Name.toUpperCase()\u002c\u000a                                Text: friend.Nickname\u002c\u000a                                Tag: friend\u002c\u000a                                HasChildren: false\u002c\u000a                                ImageSrc: GetHeadIMG(friend\u002c 16\u002c config.ShowState \u0026\u0026 friend.State == \u0022Offline\u0022)\u000a                            });\u000a                        }\u000a                        else\u000a                        {\u000a                            nodes.push({\u000a                                Name: friend.Name.toUpperCase()\u002c\u000a                                Text: friend.Nickname\u002c\u000a                                Tag: friend\u002c\u000a                                HasChildren: false\u002c\u000a                                ImageCss: \u0022Image16_Group\u0022\u000a                            });\u000a                        }\u000a                    }\u000a                }\u000a                callback(nodes);\u000a            });\u000a        }\u000a    }\u000a\u000a    return obj;\u000a}","Count":0,"Left":19,"Top":15,"Width":243,"Height":620,"Name":"FriendPanel","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"ToolbarPH","Config":{"_Css":"toolbar","OnCommandCode":"if (command == \u0022Option\u0022)\u000a{\u000a    var toolbar_btn_dom = m_Toolbar.GetControl(0);\u000a    var coord = IMCore.Utility.GetClientCoord(toolbar_btn_dom);\u000a    m_Menu.Popup(coord.X\u002c coord.Y + toolbar_btn_dom.offsetHeight + 2);\u000a}","InitCode":"","Controls":[],"_Items":[{"Text":"功能菜单","Css":"Image22_Add","Command":"Option"}],"Count":0,"Left":2,"Top":2,"Width":229,"Height":24,"Name":"m_Toolbar","Text":"功能菜单","AnchorStyle":7}},{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"m_FriendPanel_Config.BorderWidth = 1;\u000am_FriendPanel_Config.DSConfig = {\u000a    ShowState: true\u000a};","InitCode":"","ClassName":"FriendPanel","Count":0,"Left":2,"Top":27,"Width":229,"Height":679,"Name":"m_FriendPanel","Text":"","AnchorStyle":15}}],"MemberCode":"m_FriendPanel.Refresh(function()\u000a{\u000a    m_FriendPanel.Expand(EmptyCallback\u002c \u0022/Users\u0022);\u000a    m_FriendPanel.Expand(EmptyCallback\u002c \u0022/Groups\u0022);\u000a});\u000a\u000avar menuConfig = {\u000a    Items: [{\u000a        Text: \u0022修改个人资料\u0022\u002c\u000a        ID: \u0022UpdateSelfInfo\u0022\u000a    }\u002c\u000a    {\u000a        Text: \u0022添加好友/群\u0022\u002c\u000a        ID: \u0022AddFriend\u0022\u000a    }\u002c\u000a    {\u000a        Text: \u0022好友/群管理\u0022\u002c\u000a        ID: \u0022Management\u0022\u000a    }\u002c\u000a    {\u000a        Text: \u0022消息管理\u0022\u002c\u000a        ID: \u0022MsgHistory\u0022\u000a    }]\u000a};\u000a\u000avar m_Menu = new Controls.Menu(menuConfig);\u000am_Menu.OnCommand.Attach(\u000afunction(command)\u000a{\u000a    if (command == \u0022AddFriend\u0022)\u000a    {\u000a        IMCore.Session.GetGlobal(\u0022SingletonForm\u0022).ShowAddFriendForm();\u000a    }\u000a    else if (command == \u0022Management\u0022)\u000a    {\u000a        IMCore.Session.GetGlobal(\u0022SingletonForm\u0022).ShowFriendManagementForm();\u000a    }\u000a    else if (command == \u0022MsgHistory\u0022)\u000a    {\u000a        IMCore.Session.GetGlobal(\u0022SingletonForm\u0022).ShowMsgHistoryForm();\u000a    }\u000a    else if (command == \u0022UpdateSelfInfo\u0022)\u000a    {\u000a        IMCore.Session.GetGlobal(\u0022SingletonForm\u0022).ShowUpdateSelfInfoForm();\u000a    }\u000a});\u000a\u000aCurrentWindow.OnNotify.Attach(\u000afunction(command\u002c data)\u000a{\u000a    if (command == \u0022FriendInfoChanged\u0022)\u000a    {\u000a        m_FriendPanel.Refresh(function()\u000a        {\u000a            m_FriendPanel.Expand(EmptyCallback\u002c \u0022/Users\u0022);\u000a            m_FriendPanel.Expand(EmptyCallback\u002c \u0022/Groups\u0022);\u000a        });\u000a    }\u000a    else if (command == \u0022UserInfoChanged\u0022)\u000a    {\u000a        CurrentWindow.SetTitle(IMCore.Session.GetUserInfo().Nickname);\u000a    }\u000a    else if (command == \u0022UserStateChanged\u0022)\u000a    {\u000a        m_FriendPanel.GetAllNodes(function(node)\u000a        {\u000a            if (node.GetTag() != null \u0026\u0026 node.GetTag().ID == data.User)\u000a            {\u000a                node.SetImage(GetHeadIMG(node.GetTag()\u002c 16\u002c data.State == \u0022Offline\u0022));\u000a            }\u000a        });\u000a    }\u000a});","CustomConfig":"","BaseName":"Control","GlobalCode":"Module.FriendForm = FriendForm;","Count":3,"Left":15,"Top":17,"Width":233,"Height":707,"Name":"FriendForm","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"SimpleTabControlPH","Config":{"_Css":"simple_tab_gred","_BorderWidth":1,"OnSelectedTabCode":"","InitCode":"","Tabs":[{"Text":"添加好友/群","Width":120,"ID":"ID100000007","IsSelected":true}],"DesignPHBs":[{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":12,"Top":20,"Width":95,"Height":14,"Name":"label2","Text":"群/用户账户名：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"if (IMCore.Params[\u0022Name\u0022] != undefined) m_EditNameF.SetText(IMCore.Params[\u0022Name\u0022]);","BorderWidth":1,"Count":0,"Left":112,"Top":16,"Width":202,"Height":22,"Name":"m_EditNameF","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":11,"Top":54,"Width":139,"Height":14,"Name":"label4","Text":"验证信息：","AnchorStyle":3}},{"Constructor":"TextAreaPH","Config":{"_Css":"textarea","InitCode":"","BorderWidth":1,"Count":0,"Left":11,"Top":74,"Width":302,"Height":102,"Name":"m_EditInfoF","Text":"","AnchorStyle":15}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"Common.SendAddFriendRequest(\u000afunction(result\u002c ex)\u000a{\u000a    if (!result)\u000a    {\u000a        IMCore.Utility.ShowError(ex.toString());\u000a    }\u000a    else\u000a    {\u000a        m_EditNameF.SetText(\u0022\u0022);\u000a        m_EditInfoF.SetText(\u0022\u0022)\u000a        IMCore.Utility.ShowFloatForm(\u0022添加好友的请求已发送，等待对方确认...\u0022\u002c \u0022text\u0022);\u000a    }\u000a}\u002c\u000am_EditNameF.GetText()\u002c m_EditInfoF.GetText());","InitCode":"","Count":0,"Left":249,"Top":184,"Width":64,"Height":26,"Name":"m_BtnAddFriend","Text":"确定","AnchorStyle":12}}],"Count":0,"Left":0,"Top":0,"Width":324,"Height":219,"Name":"m_Tab.GetPanel(0)","Text":"","AnchorStyle":15}}],"Count":0,"Left":1,"Top":1,"Width":326,"Height":246,"Name":"m_Tab","Text":"","AnchorStyle":15}}],"MemberCode":"","CustomConfig":"","BaseName":"Control","GlobalCode":"Module.AddFriendForm = AddFriendForm;","Count":6,"Left":31,"Top":47,"Width":328,"Height":248,"Name":"AddFriendForm","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"SimpleTabControlPH","Config":{"_Css":"simple_tab_gred","_BorderWidth":1,"OnSelectedTabCode":"if (index == 0)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在载入好友列表...\u0022);\u000a    m_FrameFriend.Navigate(String.format(\u0022FriendList.aspx?random={0}\u0022\u002c (new Date()).getTime()));\u000a}\u000aelse if (index == 1)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在载入群列表...\u0022);\u000a    m_FrameGroup.Navigate(String.format(\u0022GroupList.aspx?random={0}\u0022\u002c (new Date()).getTime()));\u000a\u000a}\u000aelse if (index == 2)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在载入用户列表...\u0022);\u000a    m_FrameAllUsers.Navigate(String.format(\u0022AllUSers.aspx?random={0}\u0022\u002c (new Date()).getTime()));\u000a\u000a}\u000aelse if (index == 3)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在载入群列表...\u0022);\u000a    m_FrameAllGroups.Navigate(String.format(\u0022AllGroups.aspx?random={0}\u0022\u002c (new Date()).getTime()));\u000a\u000a}","InitCode":"","Tabs":[{"Text":"好友管理","Width":80,"ID":"ID100000010","IsSelected":true},{"Text":"群管理","Width":80,"ID":"ID100000011","IsSelected":false},{"Text":"所有用户","Width":80,"ID":"ID100000012","IsSelected":false},{"Text":"所有群组","Width":80,"ID":"ID100000013","IsSelected":false}],"DesignPHBs":[{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"FramePH","Config":{"_Css":"frame","OnResizedCode":"","InitCode":"","CustomConfigCode":"m_FrameFriend_Config.BorderWidth = 1;","Controls":[],"Count":0,"Left":6,"Top":6,"Width":580,"Height":462,"Name":"m_FrameFriend","Text":"","AnchorStyle":15}}],"Count":0,"Left":0,"Top":0,"Width":592,"Height":473,"Name":"tab2.GetPanel(0)","Text":"","AnchorStyle":15}},{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"FramePH","Config":{"_Css":"frame","OnResizedCode":"","InitCode":"","CustomConfigCode":"m_FrameGroup_Config.BorderWidth = 1;","Controls":[],"Count":0,"Left":6,"Top":6,"Width":580,"Height":462,"Name":"m_FrameGroup","Text":"","AnchorStyle":15}}],"Count":0,"Left":0,"Top":0,"Width":592,"Height":473,"Name":"tab2.GetPanel(1)","Text":"","AnchorStyle":15}},{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"FramePH","Config":{"_Css":"frame","OnResizedCode":"","InitCode":"","CustomConfigCode":"m_FrameAllUsers_Config.BorderWidth = 1;","Controls":[],"Count":0,"Left":6,"Top":6,"Width":580,"Height":462,"Name":"m_FrameAllUsers","Text":"","AnchorStyle":15}}],"Count":0,"Left":0,"Top":0,"Width":592,"Height":473,"Name":"tab2.GetPanel(2)","Text":"","AnchorStyle":15}},{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"FramePH","Config":{"_Css":"frame","OnResizedCode":"","InitCode":"","CustomConfigCode":"m_FrameAllGroups_Config.BorderWidth = 1;","Controls":[],"Count":0,"Left":6,"Top":6,"Width":580,"Height":462,"Name":"m_FrameAllGroups","Text":"","AnchorStyle":15}}],"Count":0,"Left":0,"Top":0,"Width":592,"Height":473,"Name":"tab2.GetPanel(3)","Text":"","AnchorStyle":15}}],"Count":0,"Left":1,"Top":1,"Width":594,"Height":500,"Name":"tab2","Text":"","AnchorStyle":15}}],"MemberCode":"tab2.Select(0);\u000a\u000atab2.SetTabVisible(2\u002c IMCore.Session.GetUserName().toLowerCase() == \u0022sa\u0022);\u000atab2.SetTabVisible(3\u002c IMCore.Session.GetUserName().toLowerCase() == \u0022sa\u0022);\u000a\u000aCurrentWindow.OnNotify.Attach(\u000afunction(command\u002c data)\u000a{\u000a    if (command == \u0022FriendInfoChanged\u0022)\u000a    {\u000a        if (tab2.GetSelectedIndex() == 0)\u000a        {\u000a            CurrentWindow.Waiting(\u0022正在载入好友列表...\u0022);\u000a            m_FrameFriend.Navigate(String.format(\u0022FriendList.aspx?random={0}\u0022\u002c (new Date()).getTime()));\u000a        }\u000a        else if (tab2.GetSelectedIndex() == 1)\u000a        {\u000a            CurrentWindow.Waiting(\u0022正在载入群列表...\u0022);\u000a            m_FrameGroup.Navigate(String.format(\u0022GroupList.aspx?Type=1\u0026random={0}\u0022\u002c (new Date()).getTime()));\u000a        }\u000a    }\u000a});","CustomConfig":"","BaseName":"Control","GlobalCode":"Module.FriendManagementForm = FriendManagementForm;","Count":6,"Left":28,"Top":19,"Width":596,"Height":502,"Name":"FriendManagementForm","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[],"MemberCode":"var img = null;\u000a\u000afunction centerImage()\u000a{\u000a    if (img.width \u003e config.ImageWidth || img.height \u003e config.ImageHeight)\u000a    {\u000a        if (img.width * config.ImageHeight \u003e img.height * config.ImageWidth)\u000a        {\u000a            img.height = config.ImageWidth * img.height / img.width;\u000a            img.width = config.ImageWidth;\u000a        }\u000a        else\u000a        {\u000a            img.width = config.ImageHeight * img.width / img.height;\u000a            img.height = config.ImageHeight;\u000a        }\u000a    }\u000a    img.style.marginLeft = (This.GetClientWidth() - img.width) / 2 + \u0027px\u0027;\u000a    img.style.marginTop = (This.GetClientHeight() - img.height) / 2 + \u0027px\u0027;\u000a}\u000a\u000aThis.OnResized.Attach(\u000afunction()\u000a{\u000a    if (img != null)\u000a    {\u000a        img.style.marginLeft = (This.GetClientWidth() - img.width) / 2 + \u0027px\u0027;\u000a        img.style.marginTop = (This.GetClientHeight() - img.height) / 2 + \u0027px\u0027;\u000a    }\u000a});\u000a\u000aThis.LoadImage = function(src)\u000a{\u000a    This.GetDom().innerHTML = \u0022\u003cimg/\u003e\u0022;\u000a    img = This.GetDom().firstChild;\u000a    img.onload = centerImage;\u000a    img.src = src;\u000a}\u000a\u000aThis.GetImageSrc = function()\u000a{\u000a    return img == null ? \u0022\u0022: img.src;\u000a}","CustomConfig":"config.Css = \u0022ImageControl\u0022;","BaseName":"Control","GlobalCode":"Module.ImageControl = ImageControl;","Count":0,"Left":44,"Top":31,"Width":200,"Height":200,"Name":"ImageControl","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":11,"Top":4,"Width":51,"Height":14,"Name":"label2","Text":"登录名：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"m_EditName.GetTextBoxDom().readOnly = true;","BorderWidth":1,"Count":0,"Left":64,"Top":0,"Width":316,"Height":22,"Name":"m_EditName","Text":"","AnchorStyle":7}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":30,"Width":316,"Height":22,"Name":"m_EditNickname","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":23,"Top":34,"Width":42,"Height":14,"Name":"label5","Text":"昵称：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":60,"Width":316,"Height":22,"Name":"m_EditEMail","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":24,"Top":64,"Width":40,"Height":14,"Name":"label7","Text":"邮箱：","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":24,"Top":94,"Width":39,"Height":14,"Name":"label8","Text":"主页：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":90,"Width":316,"Height":22,"Name":"m_EditHomePage","Text":"","AnchorStyle":7}},{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"m_HeadIMG_Config.BorderWidth = 1;\u000am_HeadIMG_Config.ImageWidth = 150;\u000am_HeadIMG_Config.ImageHeight = 150;","InitCode":"","ClassName":"ImageControl","Count":0,"Left":64,"Top":184,"Width":316,"Height":180,"Name":"m_HeadIMG","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":20,"Top":186,"Width":42,"Height":14,"Name":"label11","Text":"头像：","AnchorStyle":3}},{"Constructor":"TextAreaPH","Config":{"_Css":"textarea","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":120,"Width":316,"Height":58,"Name":"m_EditRemark","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":0,"Top":124,"Width":64,"Height":14,"Name":"label14","Text":"个性签名：","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"label15.GetDom().innerHTML = \u0022\u003ca class=\u0027\u0027\u003e修改头像...\u003c/a\u003e\u003cinput type=\u0027file\u0027 name=\u0027file_headimg\u0027 id=\u0027file_headimg\u0027/\u003e\u0022\u000alabel15.GetDom().childNodes[1].onchange = function()\u000a{\u000a    if (ClientMode)\u000a    {\u000a        var file = label15.GetDom().childNodes[1];\u000a        if (file.value.indexOf(\u0022fakepath\u0022) \u003e= 0)\u000a        {\u000a            file.select();\u000a            m_HeadIMG.LoadImage(document.selection.createRange().text);\u000a        }\u000a        else\u000a        {\u000a            m_HeadIMG.LoadImage(file.value);\u000a        }\u000a    }\u000a    else\u000a    {\u000a        m_HeadIMG.LoadImage(String.format(\u0022{0}?FileName=/{1}/Public/Images/HeadImg/head_changed_warning.png\u0022\u002c IMCore.GetPageUrl(\u0022download.aspx\u0022)\u002c IMCore.Session.GetUserName()));\u000a    }\u000a}","Count":0,"Left":64,"Top":368,"Width":117,"Height":14,"Name":"label15","Text":"","AnchorStyle":3}}],"MemberCode":"This.SetInfo = function(info)\u000a{\u000a    m_EditName.SetText(info.Name);\u000a    m_EditNickname.SetText(info.Nickname);\u000a    m_EditEMail.SetText(info.EMail);\u000a    m_EditHomePage.SetText(info.HomePage);\u000a    m_EditRemark.SetText(info.Remark);\u000a    m_HeadIMG.LoadImage(String.format(\u0022{0}?user={1}\u0026gred=false\u0026headimg={2}\u0022\u002c IMCore.GetPageUrl(\u0022headimg.aspx\u0022)\u002c info.Name\u002c info.HeadIMG));\u000a}\u000a\u000aThis.GetInfo = function()\u000a{\u000a    if (m_EditName.GetText() == \u0022\u0022)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名不能为空！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditName.GetText().length \u003e 10 || m_EditName.GetText().length \u003c 2)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名格式错误，登录名只能包含数字，英文字母，长度为2-10个字符！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (!CheckName(m_EditName.GetText()))\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名格式错误，登录名只能包含数字，英文字母，长度为2-10个字符！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditNickname.GetText() == \u0022\u0022)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022昵称不能为空！\u0022);\u000a        m_EditNickname.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditNickname.GetText().length \u003e 16 || m_EditNickname.GetText().length \u003c 2)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022姓名格式错误，长度为2-16个字符\u0022);\u000a        m_EditNickname.GetTextBoxDom().focus();\u000a        return;\u000a    }\u000a\u000a    if (m_EditEMail.GetText() == \u0022\u0022)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022邮箱不能为空！\u0022);\u000a        m_EditEMail.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditEMail.GetText().length \u003e 80)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022邮箱不能超过80字符！\u0022);\u000a        m_EditEMail.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (!CheckEMail(m_EditEMail.GetText()))\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022邮箱格式错误！\u0022);\u000a        m_EditEMail.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    var info = {\u000a        Name: m_EditName.GetText()\u002c\u000a        Nickname: m_EditNickname.GetText()\u002c\u000a        EMail: m_EditEMail.GetText()\u002c\u000a        HomePage: m_EditHomePage.GetText()\u002c\u000a        Remark: m_EditRemark.GetText()\u000a    };\u000a\u000a    return info;\u000a}","CustomConfig":"config.Css=\u0022UpdateSelfInfo\u0022;","BaseName":"Control","GlobalCode":"","Count":15,"Left":106,"Top":93,"Width":380,"Height":383,"Name":"UserInfoPanel","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":10,"Top":4,"Width":52,"Height":14,"Name":"label2","Text":"群名称：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"m_EditName.GetTextBoxDom().readOnly = true;","BorderWidth":1,"Count":0,"Left":64,"Top":0,"Width":260,"Height":22,"Name":"m_EditName","Text":"","AnchorStyle":7}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":30,"Width":260,"Height":22,"Name":"m_EditNickname","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":10,"Top":34,"Width":55,"Height":14,"Name":"label5","Text":"群简称：","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":10,"Top":64,"Width":53,"Height":14,"Name":"label8","Text":"群主页：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":60,"Width":260,"Height":22,"Name":"m_EditHomePage","Text":"","AnchorStyle":7}},{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"m_HeadIMG_Config.BorderWidth = 1;\u000am_HeadIMG_Config.ImageWidth = 150;\u000am_HeadIMG_Config.ImageHeight = 150;","InitCode":"","ClassName":"ImageControl","Count":0,"Left":64,"Top":184,"Width":260,"Height":180,"Name":"m_HeadIMG","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":9,"Top":186,"Width":53,"Height":14,"Name":"label11","Text":"群LOGO：","AnchorStyle":3}},{"Constructor":"TextAreaPH","Config":{"_Css":"textarea","InitCode":"","BorderWidth":1,"Count":0,"Left":64,"Top":92,"Width":260,"Height":86,"Name":"m_EditRemark","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":9,"Top":94,"Width":55,"Height":14,"Name":"label14","Text":"群介绍：","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"label15.GetDom().innerHTML = \u0022\u003ca class=\u0027\u0027\u003e修改头像...\u003c/a\u003e\u003cinput type=\u0027file\u0027 name=\u0027file_headimg\u0027 id=\u0027file_headimg\u0027/\u003e\u0022\u000alabel15.GetDom().childNodes[1].onchange = function()\u000a{\u000a    if (ClientMode)\u000a    {\u000a        var file = label15.GetDom().childNodes[1];\u000a        if (file.value.indexOf(\u0022fakepath\u0022) \u003e= 0)\u000a        {\u000a            file.select();\u000a            m_HeadIMG.LoadImage(document.selection.createRange().text);\u000a        }\u000a        else\u000a        {\u000a            m_HeadIMG.LoadImage(file.value);\u000a        }\u000a    }\u000a    else\u000a    {\u000a        m_HeadIMG.LoadImage(String.format(\u0022{0}?FileName=/{1}/Public/Images/HeadImg/head_changed_warning.png\u0022\u002c IMCore.GetPageUrl(\u0022download.aspx\u0022)\u002c IMCore.Session.GetUserName()));\u000a    }\u000a}","Count":0,"Left":64,"Top":368,"Width":117,"Height":14,"Name":"label15","Text":"","AnchorStyle":3}}],"MemberCode":"This.SetInfo = function(info)\u000a{\u000a    m_EditName.SetText(info.Name);\u000a    m_EditNickname.SetText(info.Nickname);\u000a    m_EditHomePage.SetText(info.HomePage);\u000a    m_EditRemark.SetText(info.Remark);\u000a    m_HeadIMG.LoadImage(String.format(\u0022{0}?user={1}\u0026gred=false\u0026headimg={2}\u0022\u002c IMCore.GetPageUrl(\u0022headimg.aspx\u0022)\u002c info.Name\u002c info.HeadIMG));\u000a}\u000a\u000aThis.GetInfo = function()\u000a{\u000a    if (m_EditName.GetText() == \u0022\u0022)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名不能为空！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditName.GetText().length \u003e 10 || m_EditName.GetText().length \u003c 2)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名格式错误，登录名只能包含数字，英文字母，长度为2-10个字符！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (!CheckName(m_EditName.GetText()))\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022登录名格式错误，登录名只能包含数字，英文字母，长度为2-10个字符！\u0022);\u000a        m_EditName.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditNickname.GetText() == \u0022\u0022)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022昵称不能为空！\u0022);\u000a        m_EditNickname.GetTextBoxDom().focus();\u000a        return null;\u000a    }\u000a\u000a    if (m_EditNickname.GetText().length \u003e 16 || m_EditNickname.GetText().length \u003c 2)\u000a    {\u000a        IMCore.Utility.ShowWarning(\u0022姓名格式错误，长度为2-16个字符\u0022);\u000a        m_EditNickname.GetTextBoxDom().focus();\u000a        return;\u000a    }\u000a\u000a    var info = {\u000a        Name: m_EditName.GetText()\u002c\u000a        Nickname: m_EditNickname.GetText()\u002c\u000a        HomePage: m_EditHomePage.GetText()\u002c\u000a        Remark: m_EditRemark.GetText()\u000a    };\u000a\u000a    return info;\u000a}","CustomConfig":"config.Css=\u0022UpdateSelfInfo\u0022;","BaseName":"Control","GlobalCode":"","Count":15,"Left":9,"Top":10,"Width":324,"Height":388,"Name":"GroupInfoPanel","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"SimpleTabControlPH","Config":{"_Css":"simple_tab_gred","_BorderWidth":1,"OnSelectedTabCode":"var state = GetState();\u000astate.Tab = index;\u000aResetState(state);","InitCode":"tab1.Select(GetState().Tab);","Tabs":[{"Text":"个人资料","Width":80,"ID":"ID100000016","IsSelected":true},{"Text":"修改密码","Width":80,"ID":"ID100000017","IsSelected":false}],"DesignPHBs":[{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"","InitCode":"","ClassName":"UserInfoPanel","Count":0,"Left":10,"Top":10,"Width":337,"Height":398,"Name":"m_Info","Text":"","AnchorStyle":15}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"var info = m_Info.GetInfo();\u000aif (info != null)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在更新个人资料...\u0022);\u000a    DoCommand(\u0022Update\u0022\u002c info);\u000a}","InitCode":"","Count":0,"Left":276,"Top":414,"Width":70,"Height":26,"Name":"m_BtnOK","Text":"更 新","AnchorStyle":12}}],"Count":0,"Left":0,"Top":0,"Width":356,"Height":446,"Name":"tab1.GetPanel(0)","Text":"","AnchorStyle":15}},{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":22,"Top":27,"Width":52,"Height":14,"Name":"label4","Text":"原密码：","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":22,"Top":65,"Width":52,"Height":14,"Name":"label8","Text":"新密码：","AnchorStyle":3}},{"Constructor":"PasswordPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":77,"Top":23,"Width":265,"Height":22,"Name":"m_EditPrePassword","Text":"","AnchorStyle":7}},{"Constructor":"PasswordPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":77,"Top":61,"Width":265,"Height":22,"Name":"m_EditPassword","Text":"","AnchorStyle":7}},{"Constructor":"PasswordPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":77,"Top":98,"Width":265,"Height":22,"Name":"m_EditPasswordConfirm","Text":"","AnchorStyle":7}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":10,"Top":102,"Width":64,"Height":14,"Name":"label12","Text":"密码确认：","AnchorStyle":7}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"/*if (m_EditPrePassword.GetText() == \u0022\u0022)\u000a{\u000a    IMCore.Utility.ShowWarning(\u0022请输入原密码！\u0022);\u000a    m_EditPrePassword.GetPasswordDom().focus();\u000a    return;\u000a}\u000a\u000aif (!CheckPassword(m_EditPrePassword.GetText()))\u000a{\u000a    IMCore.Utility.ShowWarning(\u0022密码必须由4-10位字母或数字组成！\u0022);\u000a    m_EditPrePassword.GetPasswordDom().focus();\u000a    return;\u000a}\u000a*/\u000aif (m_EditPassword.GetText() == \u0022\u0022)\u000a{\u000a    IMCore.Utility.ShowWarning(\u0022请输入新密码！\u0022);\u000a    m_EditPassword.GetPasswordDom().focus();\u000a    return;\u000a}\u000a\u000aif (!CheckPassword(m_EditPassword.GetText()))\u000a{\u000a    IMCore.Utility.ShowWarning(\u0022密码必须由4-10位字母或数字组成！\u0022);\u000a    m_EditPassword.GetPasswordDom().focus();\u000a    return;\u000a}\u000a\u000aif (m_EditPasswordConfirm.GetText() != m_EditPassword.GetText())\u000a{\u000a    IMCore.Utility.ShowWarning(\u0022两次输入密码不一致！\u0022);\u000a    m_EditPasswordConfirm.GetPasswordDom().focus();\u000a    return;\u000a}\u000a\u000avar data = {\u000a    PreviousPassword: m_EditPrePassword.GetText()\u002c\u000a    Password: m_EditPassword.GetText()\u000a};\u000a\u000aCurrentWindow.Waiting(\u0022正在修改密码...\u0022);\u000aDoCommand(\u0022ChangePassword\u0022\u002c data);","InitCode":"","Count":0,"Left":251,"Top":142,"Width":90,"Height":26,"Name":"BtnAlterPassword","Text":"修改密码","AnchorStyle":6}}],"Count":0,"Left":0,"Top":0,"Width":356,"Height":446,"Name":"tab1.GetPanel(1)","Text":"","AnchorStyle":15}}],"Count":0,"Left":1,"Top":1,"Width":358,"Height":473,"Name":"tab1","Text":"","AnchorStyle":15}}],"MemberCode":"m_Info.SetInfo(GetState().SelfInfo);","CustomConfig":"","BaseName":"Control","GlobalCode":"Module.UpdateSelfInfo = UpdateSelfInfo;","Count":13,"Left":86,"Top":35,"Width":360,"Height":475,"Name":"UpdateSelfInfo","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"SimpleTabControlPH","Config":{"_Css":"simple_tab_gred","_BorderWidth":1,"OnSelectedTabCode":"","InitCode":"","Tabs":[{"Text":"群资料","Width":80,"ID":"ID100000020","IsSelected":true}],"DesignPHBs":[{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"","InitCode":"","ClassName":"GroupInfoPanel","Count":0,"Left":10,"Top":10,"Width":337,"Height":398,"Name":"m_Info","Text":"","AnchorStyle":3}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"var info = m_Info.GetInfo();\u000aif (info != null)\u000a{\u000a    CurrentWindow.Waiting(\u0022正在更新群资料...\u0022);\u000a    DoCommand(\u0022Update\u0022\u002c info);\u000a}","InitCode":"","Count":0,"Left":265,"Top":415,"Width":81,"Height":26,"Name":"BtnOK","Text":"更 新","AnchorStyle":9}}],"Count":0,"Left":0,"Top":0,"Width":356,"Height":446,"Name":"tab1.GetPanel(0)","Text":"","AnchorStyle":15}}],"Count":0,"Left":1,"Top":1,"Width":358,"Height":473,"Name":"tab1","Text":"","AnchorStyle":15}}],"MemberCode":"m_Info.SetInfo(GetState().AccountInfo);","CustomConfig":"","BaseName":"Control","GlobalCode":"Module.UpdateGroupInfo = UpdateGroupInfo;","Count":3,"Left":37,"Top":60,"Width":360,"Height":475,"Name":"UpdateGroupInfo","Text":"CustomControl1","AnchorStyle":3}}],"InitCode":"IMCore.LoadModules(function()\u000a{\u000a    Common = IMCore.GetModule(\u0022Common.js\u0022);\u000a    completeCallback();\u000a}\u002c\u000aerrorCallback\u002c [\u0022Common.js\u0022]);","DisposeCode":"completeCallback();","ModuleGlobalCode":"var Common = null;\u000a\u000afunction EmptyCallback()\u000a{\u000a\u000a}\u000a\u000afunction Match(reg\u002c str)\u000a{\u000a    reg.lastIndex = 0;\u000a    var ft = reg.exec(str);\u000a    return (ft != null \u0026\u0026 ft.length == 1 \u0026\u0026 ft[0] == str)\u000a}\u000a\u000afunction CheckEMail(email)\u000a{\u000a    return Match(/[a-zA-Z0-9._\u005c-]+@[a-zA-Z0-9._\u005c-]+/ig\u002c email);\u000a}\u000a\u000afunction CheckTel(tel)\u000a{\u000a    return Match(/[0-9\u005c-]{6\u002c30}/ig\u002c tel);\u000a}\u000a\u000afunction CheckMobile(mobile)\u000a{\u000a    return Match(/[0-9]{11\u002c11}/ig\u002c mobile);\u000a}\u000a\u000afunction CheckName(name)\u000a{\u000a    return Match(/[0-9a-zA-Z]+/ig\u002c name);\u000a}\u000a\u000afunction CheckPassword(pwd)\u000a{\u000a    return Match(/[0-9a-zA-Z]{4\u002c10}/ig\u002c pwd);\u000a}\u000a\u000afunction GetHeadIMG(info\u002c size\u002c gred)\u000a{\u000a    if (info.HeadIMG == \u0022\u0022)\u000a    {\u000a        var url = IMCore.Config.ServiceUrl + \u0022/images/HeadIMG/user\u0022\u000a        if (size \u003e 0) url += \u0022.\u0022 + size;\u000a        if (gred) url += \u0022.gred\u0022;\u000a        url += \u0022.png\u0022;\u000a        return url;\u000a    }\u000a    else\u000a    {\u000a        return String.format(\u0022{0}?user={1}\u0026size={2}\u0026gred={3}\u0026headimg={4}\u0022\u002c IMCore.GetPageUrl(\u0022headimg.aspx\u0022)\u002c info.Name\u002c size\u002c gred\u002c info.HeadIMG);\u000a    }\u000a}"},"Css":"","Version":"1.0"}