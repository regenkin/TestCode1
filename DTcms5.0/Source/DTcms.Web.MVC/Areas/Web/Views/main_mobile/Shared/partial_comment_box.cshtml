@using DTcms.Model;
@using DTcms.Common;
@{
   DTcms.Model.sites site = ViewData["site"] as DTcms.Model.sites;
   DTcms.Model.sysconfig config = ViewData["sysConfig"] as DTcms.Model.sysconfig;
   DTcms.Web.MVC.UI.Controllers.BaseController bc = ViewBag.BasePage as DTcms.Web.MVC.UI.Controllers.BaseController;
   DTcms.Model.article m = ViewData["model"] as DTcms.Model.article;
   int comment_count = bc.get_comment_count(m.channel_id, m.id, "is_lock=0");<!--取得评论总数-->
}
<script type="text/javascript" src="@(config.webpath)scripts/jquery/Validform_v5.3.2_min.js"></script>
<script type="text/javascript" src="@(config.webpath)scripts/lhgdialog/lhgdialog.js?skin=idialog"></script>
      <script>
         //初始化评论列表
         function InitCommentList(){
            CommentAjaxList('#btnLoadComment','#comment_list',10,@comment_count,'@(config.webpath)tools/submit_ajax.ashx?action=comment_list&article_id=@m.id');
         }
         //页面加载完毕事件
         $(document).ready(function(){
            //初始化评论列表
            InitCommentList(); //加载第一页评论列表
            //初始化发表评论表单
            AjaxInitForm('#comment_form', '#btnSubmit', 1);
         });
		
      </script>
      <div class="section">
        <h1><span>共@(comment_count)条评论</span>网友评论</h1>
      </div>
      <div>
        <div class="comment-add">
          <form id="comment_form" name="comment_form" url="@(config.webpath)tools/submit_ajax.ashx?action=comment_add&article_id=@m.id">
            <div>
               @Html.TextArea("txtContent", new {rows="3", placeholder="吐槽一下", datatype="*", nullmsg="请填写评论内容", errormsg="请填写评论内容", sucmsg=" "})
            </div>
            <div class="btn-list">
              <input id="btnSubmit" name="submit" type="submit" value="发表" class="btn" />
              <input id="txtCode" name="txtCode" type="text" class="code" maxlength="4" placeholder="验证码" datatype="s4-4" nullmsg="请填写验证码" errormsg="请填写4位验证码" sucmsg=" " />
              <a href="javascript:;" onclick="ToggleCode(this, '@(config.webpath)tools/verify_code.ashx');return false;"><img src="@(config.webpath)tools/verify_code.ashx" width="80" height="25" style="vertical-align:middle;" /> 看不清楚？</a>
            </div>
          </form>
        </div>
        <ol id="comment_list" class="comment-list">
          <p class="nodata">暂无评论，快来抢沙发吧！</p>
        </ol>
      </div>
      @if(comment_count>0){
      <div class="more-comment">
        <input id="btnLoadComment" type="button" value="加载更多评论" class="btn" onclick="InitCommentList();">
      </div>
      }